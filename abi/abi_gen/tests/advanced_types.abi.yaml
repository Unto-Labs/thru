abi:
  package: "thru.test.advanced"
  abi-version: 1
  package-version: "1.0.0"
  description: "Advanced test types with variable-sized structures, FAMs, and complex field references"
  imports: []

types:
  - name: "box"
    kind:
      struct:
        packed: true
        fields:
          - name: "tag"
            field-type:
              primitive: u16

  - name: "TaggedUnionWithFAM"
    kind:
      struct:
        packed: true
        fields:
          - name: "hdr"
            field-type:
              type-ref:
                name: "box"
          - name: "data"
            field-type:
              size-discriminated-union:
                packed: true
                variants:
                  - name: "FAMVariant"
                    expected-size: 8
                    variant-type:
                      struct:
                        packed: true
                        fields:
                          - name: "data1"
                            field-type:
                              primitive: u8
                          - name: "arr"
                            field-type:
                              array:
                                size:
                                  field-ref:
                                    path: ["data1"]
                                element-type:
                                  array:
                                    size:
                                      field-ref:
                                        path: ["data1"]
                                    element-type:
                                      primitive: u8
                  - name: "TaggedUnionWithFAM::data"
                    expected-size: 8
                    variant-type:
                      enum:
                        packed: true
                        tag-ref:
                          field-ref:
                            path: ["hdr", "tag"]
                        variants:
                          - name: "data3"
                            tag-value: 3
                            variant-type:
                              primitive: u64
                          - name: "data4"
                            tag-value: 4
                            variant-type:
                              primitive: u64
          - name: "ghostnumber"
            field-type:
              primitive: u32

  - name: "DynamicBuffer"
    kind:
      struct:
        packed: true
        fields:
          - name: "box"
            field-type:
              struct:
                packed: true
                fields:
                  - name: "first"
                    field-type:
                      primitive: u32
          - name: "second"
            field-type:
              primitive: u32
          - name: "data"
            field-type:
              array:
                size:
                  field-ref:
                    path: ["box", "first"]
                element-type:
                  array:
                    size:
                      field-ref:
                        path: ["second"]
                    element-type:
                      primitive: u8
          - name: "data2"
            field-type:
              array:
                size:
                  field-ref:
                    path: ["second"]
                element-type:
                  primitive: u16
          - name: "mycatenum"
            field-type:
              type-ref:
                name: "CatEnum"
          - name: "catcatcat"
            field-type:
              primitive: u8

  - name: "CatEnum"
    kind:
      struct:
        packed: true
        fields:
          - name: "tag"
            field-type:
              primitive: u8
          - name: "body"
            field-type:
              enum:
                packed: true
                tag-ref:
                  field-ref:
                    path: ["tag"]
                variants:
                  - name: "BlackCat"
                    tag-value: 1
                    variant-type:
                      primitive: u64
                  - name: "WhiteCat"
                    tag-value: 2
                    variant-type:
                      primitive: u64

  - name: "myunion"
    kind:
      union:
        packed: true
        variants:
          - name: "smallval"
            variant-type:
              primitive: u8
          - name: "largeval"
            variant-type:
              primitive: u64
          - name: "array"
            variant-type:
              array:
                size:
                  literal:
                    u64: 27
                element-type:
                  primitive: u8
          - name: "structref"
            variant-type:
              type-ref:
                name: "box"
          - name: "structinline"
            variant-type:
              struct:
                packed: true
                fields:
                  - name: "a"
                    field-type:
                      primitive: u32
                  - name: "b"
                    field-type:
                      primitive: u32
